# 슬랙 알림 기능 설정 가이드

## Railway 환경 변수 설정

슬랙 알림 기능을 사용하려면 Railway 대시보드에서 다음 환경 변수를 설정해야 합니다.

### 1. Railway 대시보드 접속
1. [railway.app](https://railway.app) 접속
2. 프로젝트 선택
3. `crm-server` 서비스 선택
4. `Variables` 탭 클릭

### 2. 환경 변수 추가

다음 두 가지 환경 변수를 추가하세요:

```bash
SLACK_BOT_TOKEN=xoxb-your-actual-slack-bot-token-here
SLACK_CHANNEL_ID=C07UHNBPVUK
```

**주의사항:**
- `SLACK_BOT_TOKEN`: 슬랙 앱 설정에서 받은 봇 토큰을 입력하세요 (xoxb-로 시작)
- `SLACK_CHANNEL_ID`: 알림을 받을 채널의 ID입니다
  - 채널 이름(예: `#general`)을 사용할 수도 있지만
  - 채널 ID(예: `C07UHNBPVUK`)를 사용하면 더 안정적입니다

### 3. 슬랙 채널 ID 찾는 방법

1. 슬랙 웹/앱에서 알림을 받을 채널로 이동
2. 채널 이름을 클릭하여 채널 상세 정보 열기
3. 하단에 "채널 ID" 확인 및 복사
4. Railway 환경 변수에 설정

또는 채널 이름을 그대로 사용:
```bash
SLACK_CHANNEL_ID=#general
```

### 4. 환경 변수 적용

환경 변수를 추가/수정한 후:
1. Railway가 자동으로 재배포를 시작합니다
2. 약 2-3분 후 새로운 버전이 배포됩니다
3. 영수증 발급 시 슬랙으로 알림이 전송됩니다

## 기능 동작 방식

1. **영수증 발급**: 청구서 관리 페이지에서 청구서를 기반으로 영수증을 발급합니다
2. **자동 알림**: 영수증이 성공적으로 발급되면 지정된 슬랙 채널로 알림이 전송됩니다
3. **알림 내용**:
   - 영수증 번호
   - 발급일
   - 거래처 이름
   - 발급자 이름
   - 세전 금액
   - 세액
   - 총 금액

## 문제 해결

### 알림이 전송되지 않는 경우

1. **슬랙 토큰 확인**
   - Railway 환경 변수에 `SLACK_BOT_TOKEN`이 올바르게 설정되어 있는지 확인
   - 토큰이 `xoxb-`로 시작하는지 확인

2. **채널 권한 확인**
   - 슬랙 봇이 해당 채널에 추가되어 있는지 확인
   - 채널에서 `/invite @봇이름` 명령으로 봇을 초대

3. **서버 로그 확인**
   - Railway 대시보드의 `Logs` 탭에서 오류 메시지 확인
   - "Slack notification" 관련 로그 검색

### 알림은 실패해도 영수증 발급에는 영향 없음

슬랙 알림 전송에 실패하더라도:
- 영수증은 정상적으로 발급됩니다
- PDF 다운로드가 정상적으로 진행됩니다
- 시스템 로그에 경고 메시지가 기록됩니다

## 테스트 방법

1. Railway에 환경 변수 설정
2. 배포 완료 대기
3. 청구서 페이지에서 영수증 발급
4. 슬랙 채널에서 알림 확인

