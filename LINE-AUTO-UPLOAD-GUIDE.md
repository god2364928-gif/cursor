# LINE 자동 업로드 시스템 사용 가이드

Windows에서 F1 키 하나로 LINE 대화를 자동으로 내보내고 서버에 업로드하는 시스템입니다.

---

## 📋 목차

1. [시스템 개요](#시스템-개요)
2. [설치 방법](#설치-방법)
3. [초기 설정](#초기-설정)
4. [사용 방법](#사용-방법)
5. [문제 해결](#문제-해결)

---

## 시스템 개요

### 작동 흐름

```
F1 키 누름
  ↓
카테고리 선택 (영업 이력/리타겟팅/고객관리)
  ↓
LINE에서 자동으로 대화 내보내기
  ↓
C:\line_exports\에 TXT 파일 저장
  ↓
Railway 서버로 자동 업로드
  ↓
해당 페이지에 자동 등록
  ↓
완료 메시지
```

### 소요 시간
- **전체 과정: 3~5초**
- 실행 중에는 마우스/키보드 사용 불가 (잠깐만!)

---

## 설치 방법

### 1️⃣ AutoHotkey v2 설치

1. [AutoHotkey 공식 사이트](https://www.autohotkey.com/) 접속
2. **"Download"** 버튼 클릭
3. **"AutoHotkey v2.0"** (최신 버전) 다운로드
4. 다운로드한 설치 파일(`.exe`) 실행
5. 설치 진행 (기본 옵션으로 진행)

**설치 완료 확인:**
- 바탕화면이나 시작 메뉴에 "AutoHotkey" 아이콘이 생성됨
- `.ahk` 파일을 더블클릭하면 실행됨

### 2️⃣ 스크립트 파일 다운로드

1. `line-auto-upload.ahk` 파일을 다운로드
2. 원하는 위치에 저장 (예: `C:\Scripts\line-auto-upload.ahk`)
3. 파일을 우클릭 → **"Edit Script"** 선택

---

## 초기 설정

스크립트 파일(`line-auto-upload.ahk`)을 열어서 다음 항목들을 수정합니다.

### ⚙️ 필수 설정 (상단 부분)

```autohotkey
; Railway 서버 주소
RAILWAY_URL := "https://your-railway-app.railway.app"  ; ← 실제 Railway URL로 변경

; 로그인 토큰 (웹에서 로그인 후 localStorage에서 복사)
AUTH_TOKEN := "your-jwt-token-here"  ; ← 실제 토큰으로 변경

; LINE 대화 저장 폴더
EXPORT_FOLDER := "C:\line_exports"  ; ← 원하는 폴더로 변경 가능

; LINE 언어 (한국어: KR, 일본어: JP)
LINE_LANG := "KR"  ; ← 사용하는 LINE 언어에 맞게 설정
```

### 🔑 인증 토큰 얻는 방법

1. **웹 브라우저에서 시스템에 로그인**
2. **F12 키** 눌러서 개발자 도구 열기
3. **"Console" 탭** 선택
4. 다음 명령어 입력:
   ```javascript
   localStorage.getItem('token')
   ```
5. 출력된 긴 문자열(토큰) 전체를 복사
6. 스크립트의 `AUTH_TOKEN` 부분에 붙여넣기

**예시:**
```autohotkey
AUTH_TOKEN := "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOi..."
```

### 🌐 Railway URL 확인

- Railway 대시보드에서 배포된 서버 URL 확인
- 예: `https://web-production-abcd.up.railway.app`

---

## 사용 방법

### 📱 기본 사용 (F1 키)

1. **LINE 실행 및 대화방 열기**
   - 업로드하고 싶은 대화방을 열어둡니다

2. **F1 키 누르기**
   - 키보드에서 F1 키를 누릅니다

3. **카테고리 선택**
   - 창이 뜨면 다음 중 선택:
     - **영업 이력**: 새 고객으로 등록 (영업 추적 페이지)
     - **리타겟팅**: 기존 고객 히스토리 추가 (리타겟팅 페이지)
     - **고객관리**: 기존 고객 히스토리 추가 (고객관리 페이지)

4. **자동 실행**
   - LINE에서 자동으로 대화 내보내기 진행
   - 약 3~5초 소요

5. **완료 메시지 확인**
   - 성공 시: "✓ 업로드 완료!" 메시지
   - 실패 시: 오류 메시지 표시

### 🎯 카테고리별 동작

#### 영업 이력 (Sales History)
- **새 고객으로 등록**
- LINE 대화에서 자동으로 추출:
  - 상호명 (주식회사, 株式会社 등)
  - 고객명 (가장 많이 대화한 사람)
  - 전화번호 (있는 경우)
- 영업 추적 페이지에 새 행 추가

#### 리타겟팅 (Retargeting)
- **기존 고객 히스토리 추가**
- 상호명으로 고객 검색
- 일치하는 고객에게:
  - 히스토리 추가
  - 마지막 연락일 자동 업데이트
- ⚠️ 상호명이 DB에 없으면 오류 발생

#### 고객관리 (Customer Management)
- **기존 고객 히스토리 추가**
- 상호명으로 고객 검색
- 일치하는 고객에게:
  - 히스토리 추가
  - 마지막 연락일 자동 업데이트
- ⚠️ 상호명이 DB에 없으면 오류 발생

### 🔧 디버그 모드

문제가 생기면 스크립트에서 디버그 모드를 활성화:

```autohotkey
; 디버그 모드 (true: 각 단계별 메시지 표시)
DEBUG_MODE := true
```

각 단계마다 메시지가 표시되어 어디서 문제가 생기는지 확인 가능합니다.

### ⌨️ 추가 단축키

- **F2**: 현재 마우스 위치 확인 (좌표 조정 시 사용)
- **F3**: 활성 창 정보 확인

---

## 문제 해결

### ❌ "LINE이 실행 중이지 않습니다"

**원인**: LINE이 실행되지 않았거나, 대화방이 열려있지 않음

**해결**:
1. LINE 앱 실행
2. 업로드할 대화방 열기
3. 다시 F1 키 누르기

---

### ❌ "저장 대화상자를 찾을 수 없습니다"

**원인**: 
- LINE 메뉴 구조가 변경됨
- LINE 언어 설정이 잘못됨
- 메뉴 버튼 위치가 다름

**해결 1: 언어 설정 확인**
```autohotkey
LINE_LANG := "KR"  ; 한국어 LINE
; 또는
LINE_LANG := "JP"  ; 일본어 LINE
```

**해결 2: 메뉴 Down 횟수 조정**

스크립트에서 다음 부분 수정:
```autohotkey
; 한국어: "대화 저장"까지 Down 키 8번
; 일본어: "トークを保存"까지 Down 키 4번

; 수동으로 확인 후 숫자 변경
downCount := (LINE_LANG = "KR") ? 8 : 4  ; ← 숫자 변경
```

**해결 3: 수동 테스트**
1. LINE 대화방 열기
2. 우측 상단 ⋮ 클릭
3. "대화 저장" 또는 "トークを保存" 항목까지 Down 키 몇 번?
4. 스크립트에 그 숫자 입력

---

### ❌ "파일이 저장되지 않았습니다"

**원인**: 저장 폴더 권한 문제 또는 경로 오류

**해결**:
1. 저장 폴더 확인: `C:\line_exports`가 존재하는가?
2. 폴더를 수동으로 만들기
3. 또는 스크립트에서 경로 변경:
   ```autohotkey
   EXPORT_FOLDER := "D:\내문서\LINE"  ; 다른 경로로
   ```

---

### ❌ "상호명을 찾을 수 없습니다"

**원인**: LINE 대화에 회사명(주식회사, 株式会社 등)이 없음

**해결**:
- **영업 이력**으로 업로드하면 자동으로 "未設定"으로 등록됨
- 나중에 웹에서 수동으로 수정

---

### ❌ "일치하는 고객을 찾을 수 없습니다" (리타겟팅/고객관리)

**원인**: DB에 해당 상호명의 고객이 없음

**해결**:
1. 웹에서 해당 고객이 등록되어 있는지 확인
2. 상호명이 정확히 일치하는지 확인
3. 또는 **영업 이력**으로 먼저 등록 후 사용

---

### ❌ "업로드 실패" (서버 오류)

**원인**:
- 인증 토큰 만료
- 서버 연결 실패
- Railway 서버 다운

**해결 1: 토큰 갱신**
1. 웹 브라우저에서 다시 로그인
2. 새 토큰 복사
3. 스크립트의 `AUTH_TOKEN` 업데이트

**해결 2: 서버 URL 확인**
```autohotkey
RAILWAY_URL := "https://..."  ; 정확한 URL 확인
```

**해결 3: 네트워크 확인**
- 인터넷 연결 확인
- Railway 서버 상태 확인 (Railway 대시보드)

---

### 🐛 여전히 안 되는 경우

**디버그 정보 수집:**

1. 디버그 모드 활성화:
   ```autohotkey
   DEBUG_MODE := true
   ```

2. F1 실행 후 어느 단계에서 실패하는지 확인

3. F2, F3 키로 마우스 위치/창 정보 확인

4. 저장된 파일 확인: `C:\line_exports\`

5. 관리자에게 문의 시 다음 정보 제공:
   - LINE 버전 (설정 → 정보)
   - Windows 버전
   - 오류 메시지 전체
   - 디버그 모드에서 어느 단계까지 성공했는지

---

## 💡 팁

### 자동 시작 설정

Windows 시작 시 자동으로 스크립트 실행:

1. `Win + R` → `shell:startup` 입력
2. 시작 프로그램 폴더 열림
3. `line-auto-upload.ahk` 바로가기 생성
4. 폴더에 복사

### 토큰 보안

스크립트 파일에 토큰이 저장되므로:
- PC 보안 유지 (비밀번호 설정)
- 다른 사람과 스크립트 공유 금지
- 퇴사 시 토큰 삭제

### 여러 언어 혼용

한국어/일본어 LINE을 번갈아 사용한다면:
- F1: 한국어
- F4: 일본어

로 분리 가능 (스크립트 수정 필요)

---

## 📞 문의

문제가 계속되면 시스템 관리자에게 문의하세요.

**필요한 정보:**
- 오류 메시지 스크린샷
- LINE 버전
- Windows 버전
- 실행 로그 (디버그 모드)

---

**버전**: 1.0.0  
**최종 업데이트**: 2024.11.17

