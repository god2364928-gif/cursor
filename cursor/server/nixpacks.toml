[phases.setup]
nixPkgs = ['nodejs-18_x']

[phases.build]
cmds = [
  'npm ci',
  'rm -rf dist',
  'rm -rf node_modules/.cache',
  'rm -rf .cache',
  'npm run build',
  'ls -la dist/routes/accounting.js',
  'grep -c "Best encoding" dist/routes/accounting.js || echo "ERROR: Code not built properly"',
  'echo "✅ Build completed with new code"'
]

[start]
cmd = 'echo "=== VERIFYING BUILD ===" && grep -c "Best encoding" dist/routes/accounting.js && echo "✅ New code verified" && node dist/index.js'
