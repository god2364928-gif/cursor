[phases.setup]
nixPkgs = ['nodejs-18_x']

[phases.build]
cmds = [
  'npm ci',
  'rm -rf dist',
  'rm -rf node_modules/.cache',
  'npm run build',
  'echo "Build completed. Checking retargetingCount..."',
  'grep -n "retargetingCount.*0" dist/routes/salesTracking.js | head -3 || echo "WARNING: retargetingCount not found or not set to 0"'
]

[start]
cmd = 'node dist/index.js'
