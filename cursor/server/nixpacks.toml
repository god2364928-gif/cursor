[phases.setup]
nixPkgs = ['nodejs-18_x']

[phases.install]
cmds = [
  'echo "ğŸ“¦ Installing dependencies..."',
  'npm ci --omit=dev --prefer-offline --no-audit --progress=false'
]

[phases.build]
cmds = [
  'echo "ğŸ”¨ Building application..."',
  'npm install --no-save typescript tsx @types/node @types/express @types/cors @types/jsonwebtoken @types/bcryptjs @types/pg @types/multer @types/pdfkit',
  'npm run build',
  'test -f dist/index.js || (echo "âŒ Build failed: dist/index.js not found" && exit 1)',
  'echo "âœ… Build completed"'
]

[start]
cmd = 'node dist/index.js'
