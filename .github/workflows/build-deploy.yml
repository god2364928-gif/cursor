name: Build and Deploy

# 이 워크플로우는 빌드 검증만 수행합니다
# 실제 빌드와 커밋은 로컬의 pre-push 훅이 담당합니다
# Railway와 Vercel은 푸시 시 자동으로 배포됩니다

on:
  push:
    branches: [ main ]
    paths:
      - 'cursor/server/**'
      - 'cursor/client/**'
  pull_request:
    branches: [ main ]

jobs:
  build-server:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install server dependencies
      working-directory: cursor/server
      run: npm ci
      
    - name: Build server
      working-directory: cursor/server
      run: npm run build
      
    - name: Check build output
      working-directory: cursor/server
      run: |
        if [ ! -d "dist" ]; then
          echo "❌ dist 폴더가 생성되지 않았습니다!"
          exit 1
        fi
        echo "✅ 빌드 성공"

  build-client:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install client dependencies
      working-directory: cursor/client
      run: npm ci
      
    - name: Build client
      working-directory: cursor/client
      run: npm run build
      
    - name: Check build output
      working-directory: cursor/client
      run: |
        if [ ! -d "dist" ]; then
          echo "❌ dist 폴더가 생성되지 않았습니다!"
          exit 1
        fi
        echo "✅ 빌드 성공"

