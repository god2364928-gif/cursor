[phases.setup]
nixPkgs = ['nodejs-18_x']

[phases.build]
cmds = [
  'echo "=== Railway Build Start ==="',
  'echo "Node version: $(node --version)"',
  'echo "NPM version: $(npm --version)"',
  'cd cursor/server',
  'rm -rf node_modules dist',
  'npm ci --prefer-offline --no-audit',
  'npm run build',
  'echo "=== Verifying build output ==="',
  'ls -la dist/',
  'test -f dist/index.js || (echo "ERROR: dist/index.js not found!" && exit 1)',
  'echo "âœ… Build completed successfully at $(date)"'
]

[start]
cmd = 'cd cursor/server && node dist/index.js'
